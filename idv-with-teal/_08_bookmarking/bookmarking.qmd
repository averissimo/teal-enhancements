# Bookmarking

## Learning objectives

- Understand what bookmarking is and its role in `teal` applications
- Learn what application state is bookmarked exactly
- Master the process of creating and using bookmarks
- Understand bookmark limitations and best practices

Bookmarking in `teal` applications provides users with the ability to save and restore the complete state of their analysis session. This powerful feature enables users to share specific application configurations, return to previous analysis states, and create reproducible analysis workflows that can be shared with colleagues or revisited later.

The bookmarking functionality in `teal` leverages Shiny's built-in bookmarking capabilities, extending them to handle the complex state management required by `teal`'s modular architecture, filter panel, and data relationships.

## What is bookmarking?

**Learning Objective:** Understand the concept and purpose of bookmarking in `teal` applications.

Bookmarking in `teal` is the process of capturing and storing the complete state of a `teal` application at a specific moment in time. This includes:

- **Module Selection**: Which module is currently active
- **Filter States**: All active filters across all datasets
- **Module-Specific Settings**: Input values, plot configurations, table settings
- **Data Relationships**: The current state of data joins and relationships

## Why use bookmarking?

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=e3f9b8914285e166e05d29ddd33b1c77)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_0.qmd >}}
```

**Key Benefits of Bookmarking:**

1. **Reproducibility**: Exact analysis states can be recreated
2. **Collaboration**: Share specific application configurations with colleagues
3. **Documentation**: Bookmark key analysis states for reporting
4. **Efficiency**: Quickly return to complex filter and module configurations

## Bookmarking the state of the application

**Learning Objective:** Learn how to create bookmarks and understand the bookmarking process.

Creating a bookmark in a `teal` application captures the current state and generates a unique URL that can be used to restore that exact state.

## How to create a bookmark

The bookmarking process in `teal` applications follows these steps:

1. **Configure Your Analysis**: Set up filters, select modules, configure parameters
2. **Access Bookmark Feature**: Use the bookmark button in the application
3. **Generate Bookmark URL**: The system creates a unique URL containing the state
4. **Save or Share**: Copy the URL for future use or sharing

## Practical bookmarking example

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=c3175df9749a94088d4c263c4880c7f4)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_1.qmd >}}
```

## Step-by-step bookmarking process

1. **Launch the Application**: Start your `teal` application
2. **Configure Your Analysis**:
   - Apply filters (e.g., filter to specific treatment arms)
   - Navigate to desired module (e.g., Distribution Analysis)
   - Set module parameters (e.g., select AGE variable, stratify by ARM)
3. **Create Bookmark**: Look for the bookmark button (usually in the top right)
4. **Copy URL**: The system generates a unique URL containing all state information
5. **Test Bookmark**: Open the URL in a new browser tab to verify state restoration

## What is bookmarked exactly?

**Learning Objective:** Understand the comprehensive scope of what gets saved in a `teal` bookmark.

A `teal` bookmark captures a comprehensive snapshot of the application state, ensuring that when restored, users see exactly the same analysis configuration.

## Complete state capture

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=3a5a80088f81a2b6e9f5efa39d63aaeb)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_2.qmd >}}
```

## Detailed breakdown of bookmarked components

**1. Filter Panel State**

- All active filters across all datasets
- Filter values and ranges
- Filter relationships and dependencies
- Show/hide status of filter sections

**2. Module Navigation State**

- Currently selected module
- Module tree expansion state
- Active tab within modules

**3. Module-Specific Configuration**

- Input field values
- Variable selections
- Plot parameters (colors, shapes, themes)
- Table configurations (columns, sorting, pagination)
- Statistical analysis settings

**4. Visual State**

- Plot zoom levels and pan positions
- Table column widths and ordering
- Expanded/collapsed UI sections

**5. Data Relationships**

- Active join key relationships
- Data subset states after filtering

## What is NOT bookmarked

It's important to understand the limitations:

- **Generated Reports**: Report content is not included in bookmarks
- **Temporary Downloads**: Downloaded files are not restored
- **Session-Specific Data**: User-uploaded data or temporary modifications
- **Browser-Specific Settings**: Window size, zoom level, etc.

## Using bookmarks

**Learning Objective:** Master the practical application of bookmarks for analysis workflow management.

Once created, bookmarks serve as powerful tools for analysis reproducibility and collaboration.

## Restoring application state

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=f10c5dcfd9e82a418c3873b447a50900)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_3.qmd >}}
```

## Bookmark usage scenarios

**1. Analysis Documentation**

Create bookmarks at key analysis milestones:
1. Initial data exploration state
2. Key finding identification state
3. Final analysis configuration state

Example workflow:
Step 1: Launch app, apply basic filters -> Bookmark as "Initial_Exploration"
Step 2: Identify interesting pattern -> Bookmark as "Key_Finding_Demographics"
Step 3: Configure final analysis -> Bookmark as "Final_Analysis_Config"

**2. Collaborative Analysis**

Scenario: Share specific analysis configuration with colleague
1. Configure analysis (filters + module settings)
2. Create bookmark
3. Share URL with colleague
4. Colleague opens URL and sees exact same state
5. Colleague can continue analysis from that point

**3. Reproducible Research**

Scenario: Document analysis steps for regulatory submission
1. Create bookmark for each major analysis step
2. Document bookmark URLs in analysis plan
3. Use bookmarks to recreate exact analysis states
4. Include bookmark URLs in final report for reproducibility

## Best practices for bookmark management

**1. Descriptive Naming Convention**

Good bookmark naming approach:
- Include date: "2024_03_15_Demographics_Analysis"
- Include purpose: "Safety_Review_Committee_March"
- Include key filters: "ITT_Population_Primary_Endpoint"

**2. Bookmark Organization**

Organize bookmarks by:
- Analysis phase (Exploratory, Confirmatory, Safety)
- Data cut (Database_Lock_1, Database_Lock_2)
- Audience (DMC_Review, Regulatory_Submission)

**3. Validation and Testing**

Always validate bookmarks:
1. Test bookmark immediately after creation
2. Verify all filters are correctly restored
3. Check module configurations match expectations
4. Confirm data relationships are maintained

## Advanced bookmarking considerations

**Learning Objective:** Understand advanced bookmarking scenarios and troubleshooting approaches.

## Bookmark limitations and solutions

**1. Data Dependency Issues**

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=9a16d4e02747a2dbeb94af4e0dbff1c2)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_4.qmd >}}
```

**2. Version Compatibility**

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=8d6c6a8ec4f59955cdecbc06b90f9771)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_5.qmd >}}
```

**3. Complex Filter State Restoration**

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=86d32d37d8da7d06859620cb919ebbd3)
```{webr}
{{< include _08_bookmarking/_snippets/bookmarking_chunk_6.qmd >}}
```

## Troubleshooting common bookmark issues

**1. Bookmark URL Not Working**

- Verify data structure hasn't changed
- Check that all required packages are loaded
- Ensure teal version compatibility
- Validate that all referenced variables still exist

**2. Partial State Restoration**

- Some module settings may not restore if module configuration changed
- Filter states depend on data column availability
- Check browser console for error messages

**3. Performance Issues with Complex Bookmarks**

- Large filter states can create very long URLs
- Consider simplifying filter configurations for sharing
- Use browser bookmark management for frequently used states

## Summary

**Key Takeaways:**

1. **Bookmarking captures complete application state** including filters, module selections, and configurations
2. **Bookmarks enable reproducible analysis workflows** and facilitate collaboration
3. **Understanding what is bookmarked** helps set appropriate expectations
4. **Best practices** include descriptive naming, validation, and version documentation
5. **Limitations exist** around data dependencies and version compatibility

**Next Steps:**

- Practice creating bookmarks in different analysis scenarios
- Develop a bookmark naming convention for your organization
- Test bookmark restoration across different environments
- Integrate bookmarking into your analysis documentation workflow

The bookmarking functionality in `teal` provides a powerful foundation for reproducible
analysis and effective collaboration, making it an essential tool
for any serious analytical workflow using the `teal` framework.
