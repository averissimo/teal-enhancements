# Load and apply saved filter state
# saved_filters <- readRDS("clinical_analysis_filters.rds")

# Apply saved filters to a new application
restored_app <- teal::init(
  data = demo_data,
  modules = teal::modules(
    tm_data_table(
      label = "Filtered ADSL Data",
      dataname = "ADSL"
    ),
    tm_t_summary(
      label = "Demographics Summary",
      dataname = "ADSL",
      summarize_vars = data_extract_spec(
        dataname = "ADSL",
        select = select_spec(
          choices = variable_choices("ADSL", c("AGE", "BMIBL", "RACE")),
          selected = c("AGE", "RACE"),
          multiple = TRUE
        )
      )
    )
  ),
  filter = saved_filters  # Apply the saved filter state
)

# This application will launch with all the saved filters already applied:
# - Only Placebo and Xanomeline High Dose treatments
# - Only subjects aged 30-70
# - Only female subjects
# - Only safety population subjects

if (interactive()) {
  shiny::shinyApp(restored_app$ui, restored_app$server)
}
