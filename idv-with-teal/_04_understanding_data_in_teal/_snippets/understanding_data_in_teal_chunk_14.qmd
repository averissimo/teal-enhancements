# Strategy 1: Data type optimization
optimize_data_types <- function(df) {
  # Convert character columns to factors (saves memory)
  char_cols <- sapply(df, is.character)
  df[char_cols] <- lapply(df[char_cols], as.factor)

  return(df)
}

# Strategy 2: Sampling for development
create_development_sample <- function(data_obj, sample_size = 1000) {
  adsl <- data_obj[["ADSL"]]

  # Sample subjects
  if (nrow(adsl) > sample_size) {
    sampled_subjects <- sample(adsl$USUBJID, sample_size)

    # Create new data object with sampled data
    sample_data <- teal_data()
    sample_data <- within(sample_data, {
      ADSL <- adsl[adsl$USUBJID %in% sampled_subjects, ]

      # Filter related datasets to sampled subjects
      if ("ADAE" %in% names(data_obj@data)) {
        ADAE <- data_obj[["ADAE"]][data_obj[["ADAE"]]$USUBJID %in% sampled_subjects, ]
      }
    })

    return(sample_data)
  }

  return(data_obj)
}
