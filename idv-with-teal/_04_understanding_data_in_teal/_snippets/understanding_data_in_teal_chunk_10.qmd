# Option 1: Separate preprocessing functions
preprocess_adsl <- function(raw_adsl) {
  processed <- raw_adsl

  # Convert character variables to factors where appropriate
  factor_vars <- c("SEX", "RACE", "ARM", "ACTARM", "SAFFL", "ITTFL")
  processed[factor_vars] <- lapply(processed[factor_vars], as.factor)

  # Create age groups
  processed$AGEGR1 <- cut(processed$AGE,
                         breaks = c(0, 30, 50, 65, 100),
                         labels = c("<30", "30-50", "50-65", ">65"),
                         right = FALSE)

  # Create derived variables
  processed$AGECAT <- ifelse(processed$AGE >= 65, "Elderly", "Non-elderly")
  processed$AGECAT <- as.factor(processed$AGECAT)

  return(processed)
}

preprocess_adae <- function(raw_adae) {
  processed <- raw_adae

  # Convert to factors
  factor_vars <- c("AESEV", "AESER", "AEREL", "AEACN", "SAFFL")
  processed[factor_vars] <- lapply(processed[factor_vars], as.factor)

  # Create severity categories
  processed$AESEVN <- as.numeric(factor(processed$AESEV,
                                       levels = c("MILD", "MODERATE", "SEVERE")))

  return(processed)
}
