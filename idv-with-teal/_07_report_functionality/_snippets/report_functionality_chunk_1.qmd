# Comprehensive example demonstrating report addition
report_addition_demo <- teal::init(
  data = report_demo_data,
  modules = teal::modules(
    # Data exploration module
    tm_data_table(
      label = "ðŸ“Š ADSL Data Table",
      dataname = "ADSL"
    ),

    # Visualization modules
    teal::modules(
      label = "ðŸ“ˆ Demographics Analysis",
      tm_g_distribution(
        label = "Age Distribution by Treatment",
        dataname = "ADSL",
        dist_var = data_extract_spec(
          dataname = "ADSL",
          select = select_spec(
            choices = variable_choices("ADSL", "AGE"),
            selected = "AGE"
          )
        ),
        strata_var = data_extract_spec(
          dataname = "ADSL",
          select = select_spec(
            choices = variable_choices("ADSL", "ARM"),
            selected = "ARM"
          )
        )
      ),
      tm_g_scatterplot(
        label = "BMI vs Age Relationship",
        dataname = "ADSL",
        x = data_extract_spec(
          dataname = "ADSL",
          select = select_spec(
            choices = variable_choices("ADSL", "AGE"),
            selected = "AGE"
          )
        ),
        y = data_extract_spec(
          dataname = "ADSL",
          select = select_spec(
            choices = variable_choices("ADSL", "BMIBL"),
            selected = "BMIBL"
          )
        ),
        color_by = data_extract_spec(
          dataname = "ADSL",
          select = select_spec(
            choices = variable_choices("ADSL", "SEX"),
            selected = "SEX"
          )
        )
      )
    ),

    # Summary analysis module
    tm_t_summary(
      label = "ðŸ“‹ Baseline Demographics Summary",
      dataname = "ADSL",
      summarize_vars = data_extract_spec(
        dataname = "ADSL",
        select = select_spec(
          choices = variable_choices("ADSL", c("AGE", "SEX", "RACE", "BMIBL", "HEIGHTBL")),
          selected = c("AGE", "SEX", "RACE"),
          multiple = TRUE
        )
      ),
      by_vars = data_extract_spec(
        dataname = "ADSL",
        select = select_spec(
          choices = variable_choices("ADSL", "ARM"),
          selected = "ARM"
        )
      )
    )
  ),
  # Start with some filters to create meaningful analysis context
  filter = teal_slices(
    teal_slice(
      dataname = "ADSL",
      varname = "SAFFL",
      selected = "Y",
      title = "Safety Population"
    )
  ),
  title = "Clinical Study Report Generation"
)

# Step-by-step report addition process:
# 1. Navigate to "Age Distribution by Treatment" module
# 2. Configure the plot (age distribution by treatment arm)
# 3. Click "Add to Report" button
# 4. Add custom title: "Figure 1: Age Distribution Across Treatment Groups"
# 5. Add comment: "Safety population analysis showing age distribution"
# 6. Repeat for other modules to build comprehensive report

if (interactive()) {
  shiny::shinyApp(report_addition_demo$ui, report_addition_demo$server)
}
