# Launching `teal.modules.general`, `teal.modules.clinical` modules

## Learning objectives

- Can implement a `teal` application using pre-built modules
- Can configure pre-built modules from `teal.modules.general` and `teal.modules.clinical`
- Understand how modules integrate with `teal.data` objects

Pre-built modules are the foundation of most `teal` applications. The `teal.modules.general` (TMG) package provides versatile modules for data exploration, visualization, and analysis that work with any data structure. The `teal.modules.clinical` (TMC) package offers specialized modules designed specifically for clinical trial data analysis.

## Example of launching a `teal.modules.general` module

**Learning Objective:** Understand how to integrate and configure a basic TMG module in a `teal` application.

Let's start with a simple but complete example using one of the most commonly used modules from `teal.modules.general`: the data table module (`tm_data_table`).

## Basic data table module

The `tm_data_table` module provides an interactive data table with built-in filtering, sorting, and searching capabilities.

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=710ae5116649d91f1dea74dea13f745d)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_0.qmd >}}
```

## What you'll see in the application

When you launch this application with real pharmaverseadam data, you'll observe:

1. **Filter Panel (Left)**: Shows filtering options for all ADSL variables
   - **Categorical variables**: SEX, ARM, ACTARM, RACE, AGEGR1, COUNTRY, SAFFL, ITTFL show as checkboxes
   - **Numeric variables**: AGE, BMIBL, HEIGHTBL, WEIGHTBL show as range sliders
   - **Date variables**: RFSTDTC, RFENDTC show as date pickers
   - All filters are interconnected with the data table

2. **Main Content Area (Center)**: Displays the interactive data table with real clinical data
   - **Real subject data**: 254 subjects from the pharmaverseadam study
   - **Standard CDISC variables**: All properly labeled and formatted
   - **Sortable columns**: Click any column header to sort
   - **Search functionality**: Global search across all variables
   - **Professional appearance**: Industry-standard data presentation

3. **Module Controls**: Built-in table options
   - **Export functionality**: Download real clinical data (CSV, Excel)
   - **Column selection**: Show/hide specific CDISC variables
   - **Row selection**: Select subjects for further analysis

## Adding multiple TMG modules

Let's expand the example to include several popular TMG modules:

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=114065342eceaeeeb7dd064f13d7b139)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_1.qmd >}}
```

## Understanding module integration

Each TMG module integrates seamlessly with the `teal` framework:

1. **Data Integration**: Modules automatically connect to datasets specified in `dataname`
2. **Filter Integration**: All modules respond to filters applied in the filter panel
3. **Consistent UI**: Modules follow the same design patterns and user experience
4. **Code Generation**: Modules generate reproducible R code for all operations

## Key TMG modules and their uses

| Module | Purpose | Best For |
|--------|---------|----------|
| `tm_data_table` | Interactive data tables | Data exploration, verification |
| `tm_variable_browser` | Variable summaries and distributions | Understanding data structure |
| `tm_g_scatterplot` | Scatter plots with customization | Correlation analysis, relationships |
| `tm_g_distribution` | Distribution plots (histograms, boxplots) | Understanding variable distributions |
| `tm_t_summary` | Summary statistics tables | Descriptive statistics |
| `tm_g_association` | Association plots and tests | Categorical variable relationships |
| `tm_a_pca` | Principal Component Analysis | Dimensionality reduction |
| `tm_a_regression` | Regression analysis | Predictive modeling |

## Module configuration patterns

All TMG modules follow consistent configuration patterns:

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=071ac6f85aa2aef50167027b170649e1)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_2.qmd >}}
```

## Benefits of using TMG modules

1. **Rapid Development**: Pre-built modules eliminate need for custom Shiny development
2. **Consistency**: All modules follow the same interaction patterns
3. **Integration**: Seamless integration with filtering and data management
4. **Reproducibility**: Automatic code generation for all analyses
5. **Flexibility**: Extensive customization options through parameters
6. **Professional Quality**: Production-ready modules with error handling

## Example with multiple nested modules

**Learning Objective:** Understand how to organize complex `teal` applications using nested module structures for better navigation and logical grouping of analyses.

As your `teal` applications grow in complexity, organizing modules into logical groups becomes essential. Module nesting allows you to create hierarchical structures that improve user experience and application maintainability.

## Understanding module nesting

Module nesting in `teal` allows you to:

1. **Group related analyses** under common themes
2. **Create hierarchical navigation** for complex applications
3. **Improve user experience** with logical organization
4. **Maintain cleaner code** with structured module definitions
5. **Scale applications** without overwhelming the user interface

## Comprehensive clinical cata analysis application

Let's create a comprehensive clinical data analysis application that demonstrates advanced nested module structures:

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=916a0556d91b2742fa6e6e17fed7ac53)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_3.qmd >}}
```

## Understanding the nested structure

This comprehensive example demonstrates several levels of nesting:

## **Level 1: Main Categories (Top Navigation)**
- üìä **Data Overview**: Basic data exploration and variable browsing
- üë• **Demographics & Baseline**: All demographic and baseline analyses
- ‚ö†Ô∏è **Safety Analysis**: Adverse event analyses
- üß™ **Laboratory Analysis**: Laboratory data analyses

## **Level 2: Analysis Groups (Sub-navigation)**
Within Demographics & Baseline:
- **Demographic Distributions**: Distribution plots for key variables
- **Demographic Relationships**: Correlation and association analyses
- **Demographic Summary Tables**: Tabular summaries by treatment

## **Level 3: Specific Analyses (Individual Modules)**
Each analysis group contains specific modules focused on particular aspects.

## Benefits of this nested structure

1. **Logical Organization**: Related analyses are grouped together
2. **Scalable Navigation**: Easy to add new analyses without cluttering
3. **User-Friendly**: Clear hierarchy helps users find relevant analyses
4. **Maintainable Code**: Organized structure makes code easier to maintain
5. **Professional Appearance**: Emojis and clear labels enhance user experience

## Navigation experience

When users launch this application, they'll see:

1. **Top-level tabs**: Main analysis categories with intuitive icons
2. **Sub-level tabs**: Specific analysis groups within each category
3. **Module content**: Individual analysis modules with their specific controls
4. **Consistent filtering**: All modules respond to the same filter panel
5. **Cross-dataset integration**: Modules can access multiple datasets as configured

## Best practices for module nesting

1. **Logical Grouping**: Group modules by analysis type or data domain
2. **Clear Labels**: Use descriptive names and consider emojis for visual appeal
3. **Balanced Hierarchy**: Avoid too many nesting levels (2-3 levels maximum)
4. **Consistent Structure**: Follow similar patterns across all groups
5. **User-Centric Design**: Organize from the user's analytical workflow perspective

## Advanced nesting patterns

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=9c59711e162fc786ea72a2ed60fcc863)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_4.qmd >}}
```

This nested structure creates a professional, scalable application that can handle complex clinical data analysis workflows while maintaining excellent user experience and code organization.

---

## Understanding `data_extract_spec` objects

**Learning Objective:** Master how `data_extract_spec` objects control data selection and filtering in `teal.modules.general`, and understand the impact of `select_spec` and `filter_spec` on module behavior.

The `data_extract_spec` is the key mechanism that controls how TMG modules interact with your data. It acts as the bridge between your datasets and the module's analytical functionality, determining both which columns are available for analysis and which rows are included.

## Purpose of `data_extract_spec`

`data_extract_spec` objects serve several critical functions:

1. **Column Selection**: Define which variables from a dataset are available in module dropdowns
2. **Row Filtering**: Apply pre-filters to limit which observations are included
3. **User Interface Control**: Determine what options users see in module controls
4. **Data Processing**: Dictate how modules process and display data
5. **Analysis Scope**: Control the scope and focus of analytical outputs

## How `data_extract_spec` interacts with data

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=f9509e51b041c98f2651965258fe3dfe)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_5.qmd >}}
```

## Components of `data_extract_spec`

- **`dataname`**: Specifies which dataset to use
- **`select`**: Controls column selection via `select_spec`
- **`filter`**: Controls row filtering via `filter_spec`
- **`reshape`**: Controls data reshaping (advanced usage)

## Comparative examples: understanding the impact

Let's use the same module (`tm_g_scatterplot`) with three different `data_extract_spec` configurations to demonstrate the impact of `select_spec` and `filter_spec`.

## Example 1: Using only `select_spec`

This example shows basic column selection without any row filtering:

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=b44652a0779fe575af274d551ad65194)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_6.qmd >}}
```

## Example 2: Using only `filter_spec`

This example shows row filtering without restricting column choices:

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=a4faec6a1845860ade94b98c25ca3d30)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_7.qmd >}}
```

## Example 3: Combining `select_spec` and `filter_spec`

This example shows both column selection and row filtering working together:

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=025c49b77a5411643b0cfe63bd38c82d)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_8.qmd >}}
```

## Comparing the three examples

| Aspect | Example 1 (Select Only) | Example 2 (Filter Only) | Example 3 (Select + Filter) |
|--------|-------------------------|--------------------------|------------------------------|
| **Data Rows** | All 254 subjects | Filtered subset | Filtered subset |
| **Variable Choices** | Limited, focused options | All available variables | Limited, focused options |
| **User Experience** | Clean, focused interface | Many options, can be overwhelming | Optimal: focused + relevant |
| **Analysis Scope** | Broad population analysis | Specific population, broad variables | Specific population, focused variables |
| **Use Case** | General exploration | Population-specific analysis | Targeted, controlled analysis |

## Key insights about `data_extract_spec`

1. **`select_spec` Impact**:
   - Controls dropdown options in module UI
   - Reduces cognitive load with focused choices
   - Improves user experience with relevant variables only

2. **`filter_spec` Impact**:
   - Pre-filters data before analysis
   - Reduces dataset size for performance
   - Focuses analysis on specific populations

3. **Combined Usage**:
   - Provides optimal control over both data scope and user interface
   - Creates targeted, efficient analyses
   - Balances flexibility with focus

## Advanced `data_extract_spec` features

[Run this code in Shinylive](https://shinylive.io/r/editor/#gist=727c313507d0ffee615bb3671f8d20a4)
```{webr}
{{< include _05_launching_tmg_and_tmc_modules/_snippets/launching_tmg_and_tmc_modules_chunk_9.qmd >}}
```

## Best practices for `data_extract_spec`

1. **Start Simple**: Use `select_spec` only for initial development
2. **Add Filters Gradually**: Introduce `filter_spec` for specific use cases
3. **Focus User Choices**: Limit variable choices to relevant options
4. **Consider Performance**: Use filters to reduce data size
5. **Think User Experience**: Balance flexibility with simplicity
6. **Document Filters**: Use clear labels for filter specifications

## Impact on module behavior

The `data_extract_spec` configuration directly affects:
- **Performance**: Filtered data processes faster
- **User Interface**: Focused choices improve usability
- **Analysis Quality**: Relevant variables lead to better insights
- **Code Reproducibility**: Controlled specs ensure consistent results
- **Application Maintenance**: Well-defined specs are easier to maintain

Understanding `data_extract_spec` is crucial for creating effective TMG modules that provide users
with the right balance of flexibility and focus for their analytical needs.
